{"version":3,"file":"index.esm.js","sources":["../../../dist/plugins/typescript/urql/src/visitor.js","../../../dist/plugins/typescript/urql/src/index.js"],"sourcesContent":["import { ClientSideBaseVisitor, getConfigValue, OMIT_TYPE, } from '@graphql-codegen/visitor-plugin-common';\nimport autoBind from 'auto-bind';\nimport { Kind } from 'graphql';\nimport { pascalCase } from 'change-case-all';\nexport class UrqlVisitor extends ClientSideBaseVisitor {\n    constructor(schema, fragments, rawConfig) {\n        super(schema, fragments, rawConfig, {\n            withComponent: getConfigValue(rawConfig.withComponent, false),\n            withHooks: getConfigValue(rawConfig.withHooks, true),\n            urqlImportFrom: getConfigValue(rawConfig.urqlImportFrom, null),\n        });\n        autoBind(this);\n    }\n    getImports() {\n        const baseImports = super.getImports();\n        const imports = [];\n        const hasOperations = this._collectedOperations.length > 0;\n        if (!hasOperations) {\n            return baseImports;\n        }\n        if (this.config.withComponent) {\n            imports.push(`import * as React from 'react';`);\n        }\n        if (this.config.withComponent || this.config.withHooks) {\n            imports.push(`import * as Urql from '${this.config.urqlImportFrom || 'urql'}';`);\n        }\n        imports.push(OMIT_TYPE);\n        return [...baseImports, ...imports];\n    }\n    _buildComponent(node, documentVariableName, operationType, operationResultType, operationVariablesTypes) {\n        var _a, _b;\n        const componentName = this.convertName((_b = (_a = node.name) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : '', {\n            suffix: 'Component',\n            useTypesPrefix: false,\n        });\n        const isVariablesRequired = operationType === 'Query' &&\n            node.variableDefinitions.some(variableDef => variableDef.type.kind === Kind.NON_NULL_TYPE);\n        const generics = [operationResultType, operationVariablesTypes];\n        if (operationType === 'Subscription') {\n            generics.unshift(operationResultType);\n        }\n        return `\nexport const ${componentName} = (props: Omit<Urql.${operationType}Props<${generics.join(', ')}>, 'query'> & { variables${isVariablesRequired ? '' : '?'}: ${operationVariablesTypes} }) => (\n  <Urql.${operationType} {...props} query={${documentVariableName}} />\n);\n`;\n    }\n    _buildHooks(node, operationType, documentVariableName, operationResultType, operationVariablesTypes) {\n        var _a, _b;\n        const operationName = this.convertName((_b = (_a = node.name) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : '', {\n            suffix: this.config.omitOperationSuffix ? '' : pascalCase(operationType),\n            useTypesPrefix: false,\n        });\n        if (operationType === 'Mutation') {\n            return `\nexport function use${operationName}() {\n  return Urql.use${operationType}<${operationResultType}, ${operationVariablesTypes}>(${documentVariableName});\n};`;\n        }\n        if (operationType === 'Subscription') {\n            return `\nexport function use${operationName}<TData = ${operationResultType}>(options: Omit<Urql.Use${operationType}Args<${operationVariablesTypes}>, 'query'> = {}, handler?: Urql.SubscriptionHandler<${operationResultType}, TData>) {\n  return Urql.use${operationType}<${operationResultType}, TData, ${operationVariablesTypes}>({ query: ${documentVariableName}, ...options }, handler);\n};`;\n        }\n        return `\nexport function use${operationName}(options: Omit<Urql.Use${operationType}Args<${operationVariablesTypes}>, 'query'> = {}) {\n  return Urql.use${operationType}<${operationResultType}>({ query: ${documentVariableName}, ...options });\n};`;\n    }\n    buildOperation(node, documentVariableName, operationType, operationResultType, operationVariablesTypes) {\n        const component = this.config.withComponent\n            ? this._buildComponent(node, documentVariableName, operationType, operationResultType, operationVariablesTypes)\n            : null;\n        const hooks = this.config.withHooks\n            ? this._buildHooks(node, operationType, documentVariableName, operationResultType, operationVariablesTypes)\n            : null;\n        return [component, hooks].filter(a => a).join('\\n');\n    }\n}\n//# sourceMappingURL=visitor.js.map","import { visit, concatAST, Kind } from 'graphql';\nimport { UrqlVisitor } from './visitor';\nimport { extname } from 'path';\nexport const plugin = (schema, documents, config) => {\n    const allAst = concatAST(documents.map(v => v.document));\n    const allFragments = [\n        ...allAst.definitions.filter(d => d.kind === Kind.FRAGMENT_DEFINITION).map(fragmentDef => ({\n            node: fragmentDef,\n            name: fragmentDef.name.value,\n            onType: fragmentDef.typeCondition.name.value,\n            isExternal: false,\n        })),\n        ...(config.externalFragments || []),\n    ];\n    const visitor = new UrqlVisitor(schema, allFragments, config);\n    const visitorResult = visit(allAst, { leave: visitor });\n    return {\n        prepend: visitor.getImports(),\n        content: [visitor.fragments, ...visitorResult.definitions.filter(t => typeof t === 'string')].join('\\n'),\n    };\n};\nexport const validate = async (schema, documents, config, outputFile) => {\n    if (config.withComponent === true) {\n        if (extname(outputFile) !== '.tsx') {\n            throw new Error(`Plugin \"typescript-urql\" requires extension to be \".tsx\" when withComponent: true is set!`);\n        }\n    }\n    else {\n        if (extname(outputFile) !== '.ts' && extname(outputFile) !== '.tsx') {\n            throw new Error(`Plugin \"typescript-urql\" requires extension to be \".ts\" or \".tsx\"!`);\n        }\n    }\n};\nexport { UrqlVisitor };\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}