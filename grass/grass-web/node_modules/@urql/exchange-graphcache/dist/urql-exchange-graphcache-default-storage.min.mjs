import{_ as e}from"./08e6d3e1.min.mjs";function t(e){return new Promise((function(t,n){e.onerror=function(){n(e.error)},e.onsuccess=function(){t(e.result)}}))}function n(e){return new Promise((function(t,n){e.onerror=function(){n(e.error)},e.oncomplete=t}))}function r(){return null}function a(){}function o(){}function u(e){window.addEventListener("online",(function(){e()}))}export function makeDefaultStorage(i){function c(e){for(var t,n={},r="",a="",o=0,u=0;u<e.length;){for(t="";":"!==(r=e[u++])&&r;)t+=r;o?(n[a]=t.replace(/%3a/g,":")||void 0,o=0):(a=t.replace(/%3a/g,":"),o=1)}return n}function f(e){return(e=e.transaction("metadata","readwrite")).objectStore("metadata").clear(),e.objectStore("entries").clear(),n(e)}function s(e){return t(e.transaction("metadata","readonly").objectStore("metadata").get("metadata"))}function l(e){return t(e.transaction("entries","readwrite").objectStore("entries").put(function(){var e,t="";for(e in h){var n=h[e];t+=e.replace(/:/g,"%3a"),t+=":",n&&(t+=n.replace(/:/g,"%3a")),t+=":"}return t}(),p))}function d(){return h}i||(i={});var m=i.idbName||"graphcache-v4",h=Object.create(null),p=Math.floor((new Date).valueOf()/864e5),v=p-(i.maxAge||7),g=indexedDB.open(m,1),b=t(g);return g.onupgradeneeded=function(){g.result.createObjectStore("entries"),g.result.createObjectStore("metadata")},{clear:function(){return b.then(f)},readMetadata:function(){return b.then(s,r)},writeMetadata:function(e){b.then((function(n){return t(n.transaction("metadata","readwrite").objectStore("metadata").put(e,"metadata"))}),a)},writeData:function(t){return e(h,t),b.then(l).then(o,o)},readData:function(){var t=[];return b.then((function(r){var a=(r=r.transaction("entries","readwrite")).objectStore("entries");return(a.openKeyCursor||a.openCursor).call(a).onsuccess=function(){if(this.result){var n=this.result.key;if("number"!=typeof n||n<v)a.delete(n);else{var r=a.get(n),o=t.length;t.push(""),r.onsuccess=function(){var a=""+r.result;n===p&&e(h,c(a)),t[o]=a}}this.result.continue()}},n(r)})).then((function(){return c(t.join(""))}),d)},onOnline:u}}
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.mjs.map
