"use strict";var e=require("./1cc90026.min.js"),t=function(e){return new Promise((function(t,n){e.onerror=function(){n(e.error)},e.onsuccess=function(){t(e.result)}}))},n=function(e){return new Promise((function(t,n){e.onerror=function(){n(e.error)},e.oncomplete=t}))};function r(e){return e.replace(/:/g,"%3a")}function a(e){return e.replace(/%3a/g,":")}function o(){return null}function u(){}function i(){}function c(e){window.addEventListener("online",(function(){e()}))}exports.makeDefaultStorage=function(s){function f(e){return(e=e.transaction("metadata","readwrite")).objectStore("metadata").clear(),e.objectStore("entries").clear(),n(e)}function d(e){return t(e.transaction("metadata","readonly").objectStore("metadata").get("metadata"))}function l(e){return t(e.transaction("entries","readwrite").objectStore("entries").put(x(),p))}function m(){return v}s||(s={});var h=s.idbName||"graphcache-v4",v=Object.create(null),p=Math.floor((new Date).valueOf()/864e5),b=p-(s.maxAge||7),j=indexedDB.open(h,1),w=t(j);j.onupgradeneeded=function(){j.result.createObjectStore("entries"),j.result.createObjectStore("metadata")};var g=r,S=a,x=function(){var e,t="";for(e in v){var n=v[e];t+=g(e),t+=":",n&&(t+=g(n)),t+=":"}return t},D=function(e){for(var t,n={},r="",a="",o=0,u=0;u<e.length;){for(t="";":"!==(r=e[u++])&&r;)t+=r;o?(n[a]=S(t)||void 0,o=0):(a=S(t),o=1)}return n};return{clear:function(){return w.then(f)},readMetadata:function(){return w.then(d,o)},writeMetadata:function(e){w.then((function(n){return t(n.transaction("metadata","readwrite").objectStore("metadata").put(e,"metadata"))}),u)},writeData:function(t){return e._extends(v,t),t=i,w.then(l).then(t,t)},readData:function(){var t=[];return w.then((function(r){var a=(r=r.transaction("entries","readwrite")).objectStore("entries");return(a.openKeyCursor||a.openCursor).call(a).onsuccess=function(){if(this.result){var n=this.result.key;if("number"!=typeof n||n<b)a.delete(n);else{var r=a.get(n),o=t.length;t.push(""),r.onsuccess=function(){var a=""+r.result;n===p&&e._extends(v,D(a)),t[o]=a}}this.result.continue()}},n(r)})).then((function(){return D(t.join(""))}),m)},onOnline:c}};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.js.map
