import{toPromise as e,take as t,share as n,filter as r,map as i,tap as o,merge as u,mergeMap as s,takeUntil as c,make as p,onPush as l,makeSubject as y,publish as d,onStart as k,onEnd as v,switchMap as x,fromValue as O,subscribe as q}from"wonka";import{k as b,_ as w,s as E,C as _,m as S,a as P,b as j,c as R,d as M,e as D,f as Q}from"./70b0ab30.min.mjs";import{visit as A}from"graphql/language/visitor.mjs";import{Kind as L}from"graphql/language/kinds.mjs";import{print as N}from"graphql/language/printer.mjs";export{C as CombinedError,f as createRequest,h as getOperationName,a as makeErrorResult,m as makeResult,g as stringifyVariables}from"./70b0ab30.min.mjs";function T(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)T(e[n],t);else if("object"==typeof e&&null!==e)for(n in e)"__typename"===n&&"string"==typeof e[n]?t[e[n]]=0:T(e[n],t);return t}function I(e){return e.kind===L.FIELD&&"__typename"===e.name.value&&!e.alias}function $(e){if(e.selectionSet&&!e.selectionSet.selections.some(I))return w({},e,{selectionSet:w({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:L.FIELD,name:{kind:L.NAME,value:"__typename"}}])})})}var F=new Map;function G(e){e=b(e);var t=F.get(e.__key);return t||((t=A(e,{Field:$,InlineFragment:$})).__key=e.__key,F.set(e.__key,t)),t}function J(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,n){var r=e[n];return"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:r}):t[n]=Array.isArray(r)?r.map(J):r&&"object"==typeof r&&"__typename"in r?J(r):r,t}),{}):e}function U(n){return n.toPromise=function(){return e(t(1)(n))},n}function V(e,t,n){return n||(n=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:n}}function z(e,t){return V(e.kind,e,w({},e.context,{meta:w({},e.context.meta,t)}))}function B(){}function H(e,t,n){for(var r=0;r<n.length;r++)if(n[r].kind===L.FRAGMENT_DEFINITION){var i=n[r].name.value,o=E(n[r]);e.has(i)||(e.set(i,o),t.push(n[r]))}else t.push(n[r])}function K(e){return"subscription"!==(e=e.kind)&&"query"!==e}function W(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function X(e){return"mutation"!==(e=e.kind)&&"query"!==e}function Y(e){var t=V(e.kind,e);return t.query=G(e.query),t}function Z(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}function ee(e){return z(e,{cacheOutcome:"miss"})}function te(e){return X(e)}function ne(e){function t(e){var t=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==t&&("cache-only"===t||l.has(e.key))}function a(e){var t=l.get(e.key);return t=w({},t,{operation:z(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,re(h,e)),t}function s(e){return!X(e)&&t(e)}function c(e){function t(e){i.add(e)}var n=e.operation;if(n){var r=Object.keys(T(e.data,{})).concat(n.context.additionalTypenames||[]);if("mutation"===e.operation.kind){var i=new Set;for(e=0;e<r.length;e++){var o=r[e];(o=y[o]||(y[o]=new Set)).forEach(t),o.clear()}i.forEach((function(e){l.has(e)&&(n=l.get(e).operation,l.delete(e),re(h,n))}))}else if("query"===n.kind&&e.data)for(l.set(n.key,e),e=0;e<r.length;e++)(y[o=r[e]]||(y[o]=new Set)).add(n.key)}}function f(e){return!X(e)&&!t(e)}var p=e.forward,h=e.client,l=new Map,y=Object.create(null);return function(e){var t=n(e);return e=i(a)(r(s)(t)),t=o(c)(p(r(Z)(i(ee)(u([i(Y)(r(f)(t)),r(te)(t)]))))),u([e,t])}}function re(e,t){return e.reexecuteOperation(V(t.kind,t,w({},t.context,{requestPolicy:"network-only"})))}function ie(e){function t(e){a.delete(e.operation.key)}function n(e){var t=e.key;return"teardown"===(e=e.kind)?(a.delete(t),!0):"query"!==e&&"subscription"!==e||(e=a.has(t),a.add(t),!e)}var i=e.forward,a=new Set;return function(e){return e=r(n)(e),o(t)(i(e))}}function oe(e){return"query"===e.kind||"mutation"===e.kind}function ae(e){return"query"!==e.kind&&"mutation"!==e.kind}function ue(e){var t=e.forward;return function(e){var i=n(e);e=s((function(e){var t=e.key,n=r((function(e){return"teardown"===e.kind&&e.key===t}))(i),o=j(e),a=R(e,o);return o=M(e,o),l((function(){}))(c(n)(D(e,a,o)))}))(r(oe)(i));var o=t(r(ae)(i));return u([e,o])}}function se(){return!1}function ce(){function e(){}return function(t){return r(se)(o(e)(t))}}var fe=ce();function pe(e){return function(t){var n=t.client;return e.reduceRight((function(e,t){return t({client:n,forward:e,dispatchDebug:function(){}})}),t.forward)}}var he=[ie,ne,ue];function le(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return e||(e={}),w({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&t.suspense,requestPolicy:e.requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,n,r){return V(e,n,t.createOperationContext(r))},this.executeQuery=function(e,n){return e=t.createRequestOperation("query",e,n),t.executeRequestOperation(e)},this.executeSubscription=function(e,n){return e=t.createRequestOperation("subscription",e,n),t.executeRequestOperation(e)},this.executeMutation=function(e,n){return e=t.createRequestOperation("mutation",e,n),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var r=y(),i=r.next;this.operations$=r.source;var o=!1;this.dispatchOperation=function(e){for(o=!0,e&&i(e);e=t.queue.shift();)i(e);o=!1},this.reexecuteOperation=function(e){("mutation"===e.kind||0<(t.activeOperations[e.key]||0))&&(t.queue.push(e),o||Promise.resolve().then(t.dispatchOperation))},e=pe(void 0!==e.exchanges?e.exchanges:he),this.results$=n(e({client:this,dispatchDebug:B,forward:ce()})(this.operations$)),d(this.results$)}function ye(e){return e.data=J(e.data),e}function de(e){return new le(e)}function ke(e){var t=e.forward;return function(e){return t(e)}}function ve(e){function t(e){var t=e.error;e=e.operation,t&&n(t,e)}var n=e.onError;return function(e){var n=e.forward;return function(e){return o(t)(n(e))}}}function me(){for(var e=arguments,t=new Map,n=[],r=[],i=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",o=1;o<arguments.length;o++){var a=e[o];a&&a.definitions?r.push.apply(r,a.definitions):i+=a,i+=e[0][o]}return H(t,n,b(i).definitions),H(t,n,r),b({kind:L.DOCUMENT,definitions:n})}function xe(e){function t(t){var a=t.client,c=t.forward;return function(t){var y=e&&"boolean"==typeof e.isClient?!!e.isClient:!a.suspense,d=n(t);return t=c(r(f)(d)),d=i(p)(r(h)(d)),y?d=o(s)(d):t=o(l)(t),u([t,d])}}function a(e){return!K(e)&&void 0!==y[e.key]}function s(e){d.push(e.operation.key),1===d.length&&Promise.resolve().then(c)}function c(){for(var e;e=d.shift();)delete y[e]}function f(e){return!a(e)}function p(e){var t=y[e.key],n=t.error;return{operation:e,data:(t=t.data)?JSON.parse(t):void 0,extensions:void 0,error:n?new _({networkError:n.networkError?Error(n.networkError):void 0,graphQLErrors:n.graphQLErrors&&n.graphQLErrors.length?n.graphQLErrors:void 0}):void 0}}function h(e){return a(e)}function l(e){var t=e.operation;if(!K(t)){var n=e.data;e=e.error;var r={};void 0!==n&&(r.data=JSON.stringify(n)),e&&(r.error={graphQLErrors:e.graphQLErrors.map(W)},e.networkError&&(r.error.networkError=""+e.networkError)),y[t.key]=r}}var y={},d=[];return t.restoreData=function(e){return w(y,e)},t.extractData=function(){return w({},y)},e&&e.initialState&&t.restoreData(e.initialState),t}function ge(e){function t(e){return"subscription"===(e=e.kind)||!!o&&("query"===e||"mutation"===e)}var i=e.forwardSubscription,o=e.enableAllOperations;return function(e){function o(e){var t=i({key:e.key.toString(36),query:N(e.query),variables:e.variables,context:w({},e.context)});return p((function(n){function r(t){return u(S(e,t))}function i(t){return u(P(e,t))}function o(){c||(c=!0,"subscription"===e.kind&&f.reexecuteOperation(V("teardown",e,e.context)),s())}var a,u=n.next,s=n.complete,c=!1;return Promise.resolve().then((function(){c||(a=t.subscribe({next:r,error:i,complete:o}))})),function(){c=!0,a&&a.unsubscribe()}}))}function a(e){return!l(e)}var f=e.client,h=e.forward,l=t;return function(e){var t=n(e);e=s((function(e){var n=e.key,i=r((function(e){return"teardown"===e.kind&&e.key===n}))(t);return c(i)(o(e))}))(r(l)(t));var i=h(r(a)(t));return u([e,i])}}}le.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},le.prototype.onOperationEnd=function(e){var t=e.key,n=this.activeOperations[t]||0;if(0>=(this.activeOperations[t]=0>=n?0:n-1)){for(t=this.queue.length-1;0<=t;t--)this.queue[t].key===e.key&&this.queue.splice(t,1);this.dispatchOperation(V("teardown",e,e.context))}},le.prototype.executeRequestOperation=function(e){var n=this,o=r((function(t){return t.operation.key===e.key}))(this.results$);if(this.maskTypename&&(o=i(ye)(o)),"mutation"===e.kind)return t(1)(k((function(){return n.dispatchOperation(e)}))(o));var a=r((function(t){return"teardown"===t.kind&&t.key===e.key}))(this.operations$),s=r((function(t){return t.kind===e.kind&&t.key===e.key&&"cache-only"!==t.context.requestPolicy}))(this.operations$);return v((function(){n.onOperationEnd(e)}))(k((function(){n.onOperationStart(e)}))(x((function(e){return e.stale?O(e):u([O(e),i((function(){return w({},e,{stale:!0})}))(t(1)(s))])}))(c(a)(o))))},le.prototype.query=function(e,t,n){return n&&"boolean"==typeof n.suspense||(n=w({},n,{suspense:!1})),U(this.executeQuery(Q(e,t),n))},le.prototype.readQuery=function(e,t,n){var r=null;return q((function(e){r=e}))(this.executeQuery(Q(e,t),n)).unsubscribe(),r},le.prototype.subscription=function(e,t,n){return this.executeSubscription(Q(e,t),n)},le.prototype.mutation=function(e,t,n){return U(this.executeMutation(Q(e,t),n))};export{le as Client,ne as cacheExchange,pe as composeExchanges,de as createClient,ke as debugExchange,ie as dedupExchange,he as defaultExchanges,ve as errorExchange,fe as fallbackExchangeIO,ue as fetchExchange,G as formatDocument,me as gql,V as makeOperation,J as maskTypename,xe as ssrExchange,ge as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
